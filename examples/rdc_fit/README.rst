.. _rdc_fit:

Fit Tensor to RDC Data
======================

This example shows how to fit a :math:`{\Delta\chi}`-tensor or equivalently, and alignment tensor to experimental RDC data. These data are taken from a Tb3+ tagged ubiquitin mutant:

Benjamin J. G. Pearce, Shereen Jabar, Choy-Theng Loh, Monika Szabo, Bim Graham, Gottfried Otting (2017) Structure restraints from heteronuclear pseudocontact shifts generated by lanthanide tags at two different sites *J. Biomol. NMR* 68:19-32

Downloads
---------

* Download the data files ``2kox.pdb``, ``ubiquitin_a28c_c1_Tb_HN.rdc`` and ``ubiquitin_s57c_c1_Tb_HN.rdc`` from `here <https://github.com/henryorton/paramagpy/tree/master/examples/data_files/>`_:

* Download the script :download:`rdc_fit.py <../../../examples/rdc_fit/rdc_fit.py>`


Script + Explanation
--------------------

Firstly, the necessary modules are imported from paramagpy. And the two RDC datasets are loaded. Because this PDB contains over 600 models, loading may take a few seconds

.. literalinclude:: ../../../examples/rdc_fit/rdc_fit.py 
	:lines: 1-12

Two starting metals are initialised. It is important here to set the magnetic field strength and temperature.

.. literalinclude:: ../../../examples/rdc_fit/rdc_fit.py 
	:lines: 14-16

The alignment tensor is solved using the function :py:func:`paramagpy.fit.svd_fit_metal_from_rdc` which return a tuple of ``(metal, calculated)``, where metal is the fitted metal, calculated is the calculated RDC values. The tensors are then saved. Note that we set the argument ``ensembleAverage`` to ``True``. This is important because the PDB structure represents and MD simulation. If set to False, a much smaller tensor would be fit.

.. literalinclude:: ../../../examples/rdc_fit/rdc_fit.py 
	:lines: 18-24

*Output:* [:download:`ubiquitin_a28c_c1_Tb_tensor.txt <../../../examples/rdc_fit/ubiquitin_a28c_c1_Tb_tensor.txt>`]

.. literalinclude:: ../../../examples/rdc_fit/ubiquitin_a28c_c1_Tb_tensor.txt

*Output:* [:download:`ubiquitin_s57c_c1_Tb_tensor.txt <../../../examples/rdc_fit/ubiquitin_s57c_c1_Tb_tensor.txt>`]

.. literalinclude:: ../../../examples/rdc_fit/ubiquitin_s57c_c1_Tb_tensor.txt

The experimental/calculated correlations are then plotted. The tensor is by default fitted to the ensemble averaged calculated values. Backcalculation of all models is shown here, as well as the ensemble average.

.. literalinclude:: ../../../examples/rdc_fit/rdc_fit.py 
	:lines: 26-

*Output:* [:download:`rdc_fit.png <../../../examples/rdc_fit/rdc_fit.png>`]

.. image:: ../../../examples/rdc_fit/rdc_fit.png